-module(recon_parser_tests).

-include_lib("eunit/include/eunit.hrl").

data() ->
    {ok, Data} = file:read_file("test/test.f"),
    unicode:characters_to_list(Data).

parser_test() ->
    Data = data(),
    {ok, Tokens, _} = recon_lexer:string(Data),
    {ok, ParserF} = recon_parser:parse(Tokens),
    ?assertEqual({[{eval,{4,2},
                    {abs,{4,2},"x",{variant,[{"a",bool},{"b",bool}]},{var,{4,28},0,1}}},
                   {eval,{7,1},{string,{7,1},"hello"}},
                   {eval,{9,1},{unit,{9,1}}},
                   {eval,{11,1},{abs,{11,1},"x",{id,"A"},{var,{11,13},0,1}}},
                   {eval,{13,1},{let_,{13,1},"x",{true,{13,7}},{var,{13,15},0,1}}},
                   {eval,{15,1},
                    {timesfloat,{15,1},{float,{15,12},2.0},{float,{15,16},3.14159}}},
                   {eval,{17,1},{record,{17,1},[{"x",{true,{17,4}}},{"y",{false,{17,12}}}]}},
                   {eval,{18,18},
                    {proj,{18,18},
                     {record,{18,1},[{"x",{true,{18,4}}},{"y",{false,{18,12}}}]},
                     "x"}},
                   {eval,{19,1},{record,{19,1},[{"1",{true,{19,2}}},{"2",{false,{19,8}}}]}},
                   {eval,{20,14},
                    {proj,{20,14},
                     {record,{20,1},[{"1",{true,{20,2}}},{"2",{false,{20,8}}}]},
                     "1"}},
                   {eval,{23,1},{abs,{23,1},"x",bool,{var,{23,16},0,1}}},
                   {eval,{24,2},
                    {app,{24,2},
                     {abs,{24,2},
                      "x",
                      {arr,bool,bool},
                      {if_,{24,23},
                       {app,{24,26},{var,{24,26},0,1},{false,{24,28}}},
                       {true,{24,39}},
                       {false,{24,49}}}},
                     {abs,{25,4},
                      "x",bool,
                      {if_,{25,19},
                       {var,{25,22},0,1},
                       {false,{25,29}},
                       {true,{25,40}}}}}},
                   {eval,{27,1},{abs,{27,1},"x",nat,{succ,{27,15},{var,{27,20},0,1}}}},
                   {eval,{28,2},
                    {app,{28,2},
                     {abs,{28,2},
                      "x",nat,
                      {succ,{28,16},{succ,{28,22},{var,{28,27},0,1}}}},
                     {succ,{28,32},{zero,{28,37}}}}},
                   {bind,{30,1},"T",{ty_abb_bind,{arr,nat,nat}}},
                   {eval,{31,1},
                    {abs,{31,1},
                     "f",
                     {var,0,1},
                     {abs,{31,13},
                      "x",nat,
                      {app,{31,27},
                       {var,{31,27},1,3},
                       {app,{31,30},{var,{31,30},1,3},{var,{31,32},0,3}}}}}}],
                  [{"T",name_bind}]},
                 ParserF([])).
