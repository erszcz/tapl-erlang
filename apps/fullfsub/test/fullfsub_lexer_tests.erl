-module(fullfsub_lexer_tests).

-include_lib("eunit/include/eunit.hrl").

data() ->
    {ok, Data} = file:read_file("test/test.f"),
    unicode:characters_to_list(Data).

zero_test_() ->
    [?_assertEqual({ok, [{int_value,{1,1},"1"}, {semi,{1,2}}], 1},
                   begin
                       fullfsub_lexer:reset(),
                       fullfsub_lexer:string("1;")
                   end),
     ?_assertEqual({ok, [{int_value,{1,1},"0"}, {semi,{1,2}}], 1},
                   begin
                       fullfsub_lexer:reset(),
                       fullfsub_lexer:string("0;")
                   end),
     ?_assertEqual({ok, [{int_value,{1,1},"9"}, {semi,{1,2}}], 1},
                   begin
                       fullfsub_lexer:reset(),
                       fullfsub_lexer:string("9;")
                   end)].

lexer_test() ->
    Data = data(),
    fullfsub_lexer:reset(),
    %% This fixture was checked token by token to ensure correct lexing of test/test.f,
    %% including the line and column information.
    ?assertEqual({ok,[{comment,{1,1},"/* Examples for testing */"},
                      {lambda,{3,2}},
                      {lcid,{3,9},"x"},
                      {colon,{3,10}},
                      {ttop,{3,11}},
                      {dot,{3,14}},
                      {lcid,{3,16},"x"},
                      {semi,{3,17}},
                      {lparen,{4,3}},
                      {lambda,{4,4}},
                      {lcid,{4,11},"x"},
                      {colon,{4,12}},
                      {ttop,{4,13}},
                      {dot,{4,16}},
                      {lcid,{4,18},"x"},
                      {rparen,{4,19}},
                      {lparen,{4,21}},
                      {lambda,{4,22}},
                      {lcid,{4,29},"x"},
                      {colon,{4,30}},
                      {ttop,{4,31}},
                      {dot,{4,34}},
                      {lcid,{4,36},"x"},
                      {rparen,{4,37}},
                      {semi,{4,38}},
                      {lparen,{5,2}},
                      {lambda,{5,3}},
                      {lcid,{5,10},"x"},
                      {colon,{5,11}},
                      {ttop,{5,12}},
                      {arrow,{5,15}},
                      {ttop,{5,17}},
                      {dot,{5,20}},
                      {lcid,{5,22},"x"},
                      {rparen,{5,23}},
                      {lparen,{5,25}},
                      {lambda,{5,26}},
                      {lcid,{5,33},"x"},
                      {colon,{5,34}},
                      {ttop,{5,35}},
                      {dot,{5,38}},
                      {lcid,{5,40},"x"},
                      {rparen,{5,41}},
                      {semi,{5,42}},
                      {lparen,{8,1}},
                      {lambda,{8,2}},
                      {lcid,{8,9},"r"},
                      {colon,{8,10}},
                      {lcurly,{8,11}},
                      {lcid,{8,12},"x"},
                      {colon,{8,13}},
                      {ttop,{8,14}},
                      {arrow,{8,17}},
                      {ttop,{8,19}},
                      {rcurly,{8,22}},
                      {dot,{8,23}},
                      {lcid,{8,25},"r"},
                      {dot,{8,26}},
                      {lcid,{8,27},"x"},
                      {lcid,{8,29},"r"},
                      {dot,{8,30}},
                      {lcid,{8,31},"x"},
                      {rparen,{8,32}},
                      {lcurly,{9,3}},
                      {lcid,{9,4},"x"},
                      {eq,{9,5}},
                      {lambda,{9,6}},
                      {lcid,{9,13},"z"},
                      {colon,{9,14}},
                      {ttop,{9,15}},
                      {dot,{9,18}},
                      {lcid,{9,19},"z"},
                      {comma,{9,20}},
                      {lcid,{9,22},"y"},
                      {eq,{9,23}},
                      {lambda,{9,24}},
                      {lcid,{9,31},"z"},
                      {colon,{9,32}},
                      {ttop,{9,33}},
                      {dot,{9,36}},
                      {lcid,{9,37},"z"},
                      {rcurly,{9,38}},
                      {semi,{9,39}},
                      {string_value,{12,1},"\"hello\""},
                      {semi,{12,8}},
                      {unit,{14,1}},
                      {semi,{14,5}},
                      {lambda,{16,1}},
                      {lcid,{16,8},"x"},
                      {colon,{16,9}},
                      {ucid,{16,10},"A"},
                      {dot,{16,11}},
                      {lcid,{16,13},"x"},
                      {semi,{16,14}},
                      {'let',{18,1}},
                      {lcid,{18,5},"x"},
                      {eq,{18,6}},
                      {true,{18,7}},
                      {in,{18,12}},
                      {lcid,{18,15},"x"},
                      {semi,{18,16}},
                      {lcurly,{20,1}},
                      {lcid,{20,2},"x"},
                      {eq,{20,3}},
                      {true,{20,4}},
                      {comma,{20,8}},
                      {lcid,{20,10},"y"},
                      {eq,{20,11}},
                      {false,{20,12}},
                      {rcurly,{20,17}},
                      {semi,{20,18}},
                      {lcurly,{21,1}},
                      {lcid,{21,2},"x"},
                      {eq,{21,3}},
                      {true,{21,4}},
                      {comma,{21,8}},
                      {lcid,{21,10},"y"},
                      {eq,{21,11}},
                      {false,{21,12}},
                      {rcurly,{21,17}},
                      {dot,{21,18}},
                      {lcid,{21,19},"x"},
                      {semi,{21,20}},
                      {lcurly,{22,1}},
                      {true,{22,2}},
                      {comma,{22,6}},
                      {false,{22,8}},
                      {rcurly,{22,13}},
                      {semi,{22,14}},
                      {lcurly,{23,1}},
                      {true,{23,2}},
                      {comma,{23,6}},
                      {false,{23,8}},
                      {rcurly,{23,13}},
                      {dot,{23,14}},
                      {int_value,{23,15},"1"},
                      {semi,{23,16}},
                      {'if',{26,1}},
                      {true,{26,4}},
                      {then,{26,9}},
                      {lcurly,{26,14}},
                      {lcid,{26,15},"x"},
                      {eq,{26,16}},
                      {true,{26,17}},
                      {comma,{26,21}},
                      {lcid,{26,22},"y"},
                      {eq,{26,23}},
                      {false,{26,24}},
                      {comma,{26,29}},
                      {lcid,{26,30},"a"},
                      {eq,{26,31}},
                      {false,{26,32}},
                      {rcurly,{26,37}},
                      {else,{26,39}},
                      {lcurly,{26,44}},
                      {lcid,{26,45},"y"},
                      {eq,{26,46}},
                      {false,{26,47}},
                      {comma,{26,52}},
                      {lcid,{26,53},"x"},
                      {eq,{26,54}},
                      {lcurly,{26,55}},
                      {rcurly,{26,56}},
                      {comma,{26,57}},
                      {lcid,{26,58},"b"},
                      {eq,{26,59}},
                      {false,{26,60}},
                      {rcurly,{26,65}},
                      {semi,{26,66}},
                      {timesfloat,{28,1}},
                      {float_value,{28,12},"2.0"},
                      {float_value,{28,16},"3.14159"},
                      {semi,{28,23}},
                      {lambda,{30,1}},
                      {ucid,{30,8},"X"},
                      {dot,{30,9}},
                      {lambda,{30,11}},
                      {lcid,{30,18},"x"},
                      {colon,{30,19}},
                      {ucid,{30,20},"X"},
                      {dot,{30,21}},
                      {lcid,{30,23},"x"},
                      {semi,{30,24}},
                      {lparen,{31,1}},
                      {lambda,{31,2}},
                      {ucid,{31,9},"X"},
                      {dot,{31,10}},
                      {lambda,{31,12}},
                      {lcid,{31,19},"x"},
                      {colon,{31,20}},
                      {ucid,{31,21},"X"},
                      {dot,{31,22}},
                      {lcid,{31,24},"x"},
                      {rparen,{31,25}},
                      {lsquare,{31,27}},
                      {all,{31,28}},
                      {ucid,{31,32},"X"},
                      {dot,{31,33}},
                      {ucid,{31,34},"X"},
                      {arrow,{31,35}},
                      {ucid,{31,37},"X"},
                      {rsquare,{31,38}},
                      {semi,{31,39}},
                      {lambda,{33,1}},
                      {ucid,{33,8},"X"},
                      {leq,{33,9}},
                      {ttop,{33,11}},
                      {arrow,{33,14}},
                      {ttop,{33,16}},
                      {dot,{33,19}},
                      {lambda,{33,21}},
                      {lcid,{33,28},"x"},
                      {colon,{33,29}},
                      {ucid,{33,30},"X"},
                      {dot,{33,31}},
                      {lcid,{33,33},"x"},
                      {lcid,{33,35},"x"},
                      {semi,{33,36}},
                      {lambda,{36,1}},
                      {lcid,{36,8},"x"},
                      {colon,{36,9}},
                      {bool,{36,10}},
                      {dot,{36,14}},
                      {lcid,{36,16},"x"},
                      {semi,{36,17}},
                      {lparen,{37,1}},
                      {lambda,{37,2}},
                      {lcid,{37,9},"x"},
                      {colon,{37,10}},
                      {bool,{37,11}},
                      {arrow,{37,15}},
                      {bool,{37,17}},
                      {dot,{37,21}},
                      {'if',{37,23}},
                      {lcid,{37,26},"x"},
                      {false,{37,28}},
                      {then,{37,34}},
                      {true,{37,39}},
                      {else,{37,44}},
                      {false,{37,49}},
                      {rparen,{37,54}},
                      {lparen,{38,3}},
                      {lambda,{38,4}},
                      {lcid,{38,11},"x"},
                      {colon,{38,12}},
                      {bool,{38,13}},
                      {dot,{38,17}},
                      {'if',{38,19}},
                      {lcid,{38,22},"x"},
                      {then,{38,24}},
                      {false,{38,29}},
                      {else,{38,35}},
                      {true,{38,40}},
                      {rparen,{38,44}},
                      {semi,{38,45}},
                      {lambda,{40,1}},
                      {lcid,{40,8},"x"},
                      {colon,{40,9}},
                      {nat,{40,10}},
                      {dot,{40,13}},
                      {succ,{40,15}},
                      {lcid,{40,20},"x"},
                      {semi,{40,21}},
                      {lparen,{41,1}},
                      {lambda,{41,2}},
                      {lcid,{41,9},"x"},
                      {colon,{41,10}},
                      {nat,{41,11}},
                      {dot,{41,14}},
                      {succ,{41,16}},
                      {lparen,{41,21}},
                      {succ,{41,22}},
                      {lcid,{41,27},"x"},
                      {rparen,{41,28}},
                      {rparen,{41,29}},
                      {lparen,{41,31}},
                      {succ,{41,32}},
                      {int_value,{41,37},"0"},
                      {rparen,{41,38}},
                      {semi,{41,39}},
                      {ucid,{43,1},"T"},
                      {eq,{43,3}},
                      {nat,{43,5}},
                      {arrow,{43,8}},
                      {nat,{43,10}},
                      {semi,{43,13}},
                      {lambda,{44,1}},
                      {lcid,{44,8},"f"},
                      {colon,{44,9}},
                      {ucid,{44,10},"T"},
                      {dot,{44,11}},
                      {lambda,{44,13}},
                      {lcid,{44,20},"x"},
                      {colon,{44,21}},
                      {nat,{44,22}},
                      {dot,{44,25}},
                      {lcid,{44,27},"f"},
                      {lparen,{44,29}},
                      {lcid,{44,30},"f"},
                      {lcid,{44,32},"x"},
                      {rparen,{44,33}},
                      {semi,{44,34}},
                      {lcurly,{47,2}},
                      {star,{47,3}},
                      {all,{47,4}},
                      {ucid,{47,8},"Y"},
                      {dot,{47,9}},
                      {ucid,{47,10},"Y"},
                      {comma,{47,11}},
                      {lambda,{47,13}},
                      {lcid,{47,20},"x"},
                      {colon,{47,21}},
                      {lparen,{47,22}},
                      {all,{47,23}},
                      {ucid,{47,27},"Y"},
                      {dot,{47,28}},
                      {ucid,{47,29},"Y"},
                      {rparen,{47,30}},
                      {dot,{47,31}},
                      {lcid,{47,33},"x"},
                      {rcurly,{47,34}},
                      {as,{47,36}},
                      {lcurly,{47,39}},
                      {some,{47,40}},
                      {ucid,{47,45},"X"},
                      {comma,{47,46}},
                      {ucid,{47,47},"X"},
                      {arrow,{47,48}},
                      {ucid,{47,50},"X"},
                      {rcurly,{47,51}},
                      {semi,{47,52}},
                      {lcurly,{50,1}},
                      {star,{50,2}},
                      {nat,{50,3}},
                      {comma,{50,6}},
                      {lcurly,{50,8}},
                      {lcid,{50,9},"c"},
                      {eq,{50,10}},
                      {int_value,{50,11},"0"},
                      {comma,{50,12}},
                      {lcid,{50,14},"f"},
                      {eq,{50,15}},
                      {lambda,{50,16}},
                      {lcid,{50,23},"x"},
                      {colon,{50,24}},
                      {nat,{50,25}},
                      {dot,{50,28}},
                      {succ,{50,30}},
                      {lcid,{50,35},"x"},
                      {rcurly,{50,36}},
                      {rcurly,{50,37}},
                      {as,{51,3}},
                      {lcurly,{51,6}},
                      {some,{51,7}},
                      {ucid,{51,12},"X"},
                      {comma,{51,13}},
                      {lcurly,{51,15}},
                      {lcid,{51,16},"c"},
                      {colon,{51,17}},
                      {ucid,{51,18},"X"},
                      {comma,{51,19}},
                      {lcid,{51,21},"f"},
                      {colon,{51,22}},
                      {ucid,{51,23},"X"},
                      {arrow,{51,24}},
                      {nat,{51,26}},
                      {rcurly,{51,29}},
                      {rcurly,{51,30}},
                      {semi,{51,31}},
                      {'let',{52,1}},
                      {lcurly,{52,5}},
                      {ucid,{52,6},"X"},
                      {comma,{52,7}},
                      {lcid,{52,8},"ops"},
                      {rcurly,{52,11}},
                      {eq,{52,13}},
                      {lcurly,{52,15}},
                      {star,{52,16}},
                      {nat,{52,17}},
                      {comma,{52,20}},
                      {lcurly,{52,22}},
                      {lcid,{52,23},"c"},
                      {eq,{52,24}},
                      {int_value,{52,25},"0"},
                      {comma,{52,26}},
                      {lcid,{52,28},"f"},
                      {eq,{52,29}},
                      {lambda,{52,30}},
                      {lcid,{52,37},"x"},
                      {colon,{52,38}},
                      {nat,{52,39}},
                      {dot,{52,42}},
                      {succ,{52,44}},
                      {lcid,{52,49},"x"},
                      {rcurly,{52,50}},
                      {rcurly,{52,51}},
                      {as,{53,15}},
                      {lcurly,{53,18}},
                      {some,{53,19}},
                      {ucid,{53,24},"X"},
                      {comma,{53,25}},
                      {lcurly,{53,27}},
                      {lcid,{53,28},"c"},
                      {colon,{53,29}},
                      {ucid,{53,30},"X"},
                      {comma,{53,31}},
                      {lcid,{53,33},"f"},
                      {colon,{53,34}},
                      {ucid,{53,35},"X"},
                      {arrow,{53,36}},
                      {nat,{53,38}},
                      {rcurly,{53,41}},
                      {rcurly,{53,42}},
                      {in,{54,1}},
                      {lparen,{54,4}},
                      {lcid,{54,5},"ops"},
                      {dot,{54,8}},
                      {lcid,{54,9},"f"},
                      {lcid,{54,11},"ops"},
                      {dot,{54,14}},
                      {lcid,{54,15},"c"},
                      {rparen,{54,16}},
                      {semi,{54,17}}],
                  56},
                 fullfsub_lexer:string(Data)).
