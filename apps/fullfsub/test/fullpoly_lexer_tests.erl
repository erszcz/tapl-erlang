-module(fullpoly_lexer_tests).

-include_lib("eunit/include/eunit.hrl").

data() ->
    {ok, Data} = file:read_file("test/test.f"),
    unicode:characters_to_list(Data).

zero_test_() ->
    [?_assertEqual({ok, [{int_value,{1,1},"1"}, {semi,{1,2}}], 1},
                   begin
                       fullpoly_lexer:reset(),
                       fullpoly_lexer:string("1;")
                   end),
     ?_assertEqual({ok, [{int_value,{1,1},"0"}, {semi,{1,2}}], 1},
                   begin
                       fullpoly_lexer:reset(),
                       fullpoly_lexer:string("0;")
                   end),
     ?_assertEqual({ok, [{int_value,{1,1},"9"}, {semi,{1,2}}], 1},
                   begin
                       fullpoly_lexer:reset(),
                       fullpoly_lexer:string("9;")
                   end)].

lexer_test() ->
    Data = data(),
    fullpoly_lexer:reset(),
    %% This fixture was checked token by token to ensure correct lexing of test/test.f,
    %% including the line and column information.
    ?assertEqual({ok,[{comment,{1,1},"/* Examples for testing */"},
                      {string_value,{3,2},"\"hello\""},
                      {semi,{3,9}},
                      {unit,{5,1}},
                      {semi,{5,5}},
                      {lambda,{7,1}},
                      {lcid,{7,8},"x"},
                      {colon,{7,9}},
                      {ucid,{7,10},"A"},
                      {dot,{7,11}},
                      {lcid,{7,13},"x"},
                      {semi,{7,14}},
                      {'let',{9,1}},
                      {lcid,{9,5},"x"},
                      {eq,{9,6}},
                      {true,{9,7}},
                      {in,{9,12}},
                      {lcid,{9,15},"x"},
                      {semi,{9,16}},
                      {timesfloat,{11,1}},
                      {float_value,{11,12},"2.0"},
                      {float_value,{11,16},"3.14159"},
                      {semi,{11,23}},
                      {lambda,{13,1}},
                      {lcid,{13,8},"x"},
                      {colon,{13,9}},
                      {bool,{13,10}},
                      {dot,{13,14}},
                      {lcid,{13,16},"x"},
                      {semi,{13,17}},
                      {lparen,{14,1}},
                      {lambda,{14,2}},
                      {lcid,{14,9},"x"},
                      {colon,{14,10}},
                      {bool,{14,11}},
                      {arrow,{14,15}},
                      {bool,{14,17}},
                      {dot,{14,21}},
                      {'if',{14,23}},
                      {lcid,{14,26},"x"},
                      {false,{14,28}},
                      {then,{14,34}},
                      {true,{14,39}},
                      {else,{14,44}},
                      {false,{14,49}},
                      {rparen,{14,54}},
                      {lparen,{15,3}},
                      {lambda,{15,4}},
                      {lcid,{15,11},"x"},
                      {colon,{15,12}},
                      {bool,{15,13}},
                      {dot,{15,17}},
                      {'if',{15,19}},
                      {lcid,{15,22},"x"},
                      {then,{15,24}},
                      {false,{15,29}},
                      {else,{15,35}},
                      {true,{15,40}},
                      {rparen,{15,44}},
                      {semi,{15,45}},
                      {lambda,{17,1}},
                      {lcid,{17,8},"x"},
                      {colon,{17,9}},
                      {nat,{17,10}},
                      {dot,{17,13}},
                      {succ,{17,15}},
                      {lcid,{17,20},"x"},
                      {semi,{17,21}},
                      {lparen,{18,1}},
                      {lambda,{18,2}},
                      {lcid,{18,9},"x"},
                      {colon,{18,10}},
                      {nat,{18,11}},
                      {dot,{18,14}},
                      {succ,{18,16}},
                      {lparen,{18,21}},
                      {succ,{18,22}},
                      {lcid,{18,27},"x"},
                      {rparen,{18,28}},
                      {rparen,{18,29}},
                      {lparen,{18,31}},
                      {succ,{18,32}},
                      {int_value,{18,37},"0"},
                      {rparen,{18,38}},
                      {semi,{18,39}},
                      {ucid,{20,1},"T"},
                      {eq,{20,3}},
                      {nat,{20,5}},
                      {arrow,{20,8}},
                      {nat,{20,10}},
                      {semi,{20,13}},
                      {lambda,{21,1}},
                      {lcid,{21,8},"f"},
                      {colon,{21,9}},
                      {ucid,{21,10},"T"},
                      {dot,{21,11}},
                      {lambda,{21,13}},
                      {lcid,{21,20},"x"},
                      {colon,{21,21}},
                      {nat,{21,22}},
                      {dot,{21,25}},
                      {lcid,{21,27},"f"},
                      {lparen,{21,29}},
                      {lcid,{21,30},"f"},
                      {lcid,{21,32},"x"},
                      {rparen,{21,33}},
                      {semi,{21,34}},
                      {lambda,{24,1}},
                      {ucid,{24,8},"X"},
                      {dot,{24,9}},
                      {lambda,{24,11}},
                      {lcid,{24,18},"x"},
                      {colon,{24,19}},
                      {ucid,{24,20},"X"},
                      {dot,{24,21}},
                      {lcid,{24,23},"x"},
                      {semi,{24,24}},
                      {lparen,{25,1}},
                      {lambda,{25,2}},
                      {ucid,{25,9},"X"},
                      {dot,{25,10}},
                      {lambda,{25,12}},
                      {lcid,{25,19},"x"},
                      {colon,{25,20}},
                      {ucid,{25,21},"X"},
                      {dot,{25,22}},
                      {lcid,{25,24},"x"},
                      {rparen,{25,25}},
                      {lsquare,{25,27}},
                      {all,{25,28}},
                      {ucid,{25,32},"X"},
                      {dot,{25,33}},
                      {ucid,{25,34},"X"},
                      {arrow,{25,35}},
                      {ucid,{25,37},"X"},
                      {rsquare,{25,38}},
                      {semi,{25,39}},
                      {lcurly,{27,2}},
                      {star,{27,3}},
                      {all,{27,4}},
                      {ucid,{27,8},"Y"},
                      {dot,{27,9}},
                      {ucid,{27,10},"Y"},
                      {comma,{27,11}},
                      {lambda,{27,13}},
                      {lcid,{27,20},"x"},
                      {colon,{27,21}},
                      {lparen,{27,22}},
                      {all,{27,23}},
                      {ucid,{27,27},"Y"},
                      {dot,{27,28}},
                      {ucid,{27,29},"Y"},
                      {rparen,{27,30}},
                      {dot,{27,31}},
                      {lcid,{27,33},"x"},
                      {rcurly,{27,34}},
                      {as,{27,36}},
                      {lcurly,{27,39}},
                      {some,{27,40}},
                      {ucid,{27,45},"X"},
                      {comma,{27,46}},
                      {ucid,{27,47},"X"},
                      {arrow,{27,48}},
                      {ucid,{27,50},"X"},
                      {rcurly,{27,51}},
                      {semi,{27,52}},
                      {lcurly,{30,1}},
                      {lcid,{30,2},"x"},
                      {eq,{30,3}},
                      {true,{30,4}},
                      {comma,{30,8}},
                      {lcid,{30,10},"y"},
                      {eq,{30,11}},
                      {false,{30,12}},
                      {rcurly,{30,17}},
                      {semi,{30,18}},
                      {lcurly,{31,1}},
                      {lcid,{31,2},"x"},
                      {eq,{31,3}},
                      {true,{31,4}},
                      {comma,{31,8}},
                      {lcid,{31,10},"y"},
                      {eq,{31,11}},
                      {false,{31,12}},
                      {rcurly,{31,17}},
                      {dot,{31,18}},
                      {lcid,{31,19},"x"},
                      {semi,{31,20}},
                      {lcurly,{32,1}},
                      {true,{32,2}},
                      {comma,{32,6}},
                      {false,{32,8}},
                      {rcurly,{32,13}},
                      {semi,{32,14}},
                      {lcurly,{33,1}},
                      {true,{33,2}},
                      {comma,{33,6}},
                      {false,{33,8}},
                      {rcurly,{33,13}},
                      {dot,{33,14}},
                      {int_value,{33,15},"1"},
                      {semi,{33,16}},
                      {lcurly,{36,1}},
                      {star,{36,2}},
                      {nat,{36,3}},
                      {comma,{36,6}},
                      {lcurly,{36,8}},
                      {lcid,{36,9},"c"},
                      {eq,{36,10}},
                      {int_value,{36,11},"0"},
                      {comma,{36,12}},
                      {lcid,{36,14},"f"},
                      {eq,{36,15}},
                      {lambda,{36,16}},
                      {lcid,{36,23},"x"},
                      {colon,{36,24}},
                      {nat,{36,25}},
                      {dot,{36,28}},
                      {succ,{36,30}},
                      {lcid,{36,35},"x"},
                      {rcurly,{36,36}},
                      {rcurly,{36,37}},
                      {as,{37,3}},
                      {lcurly,{37,6}},
                      {some,{37,7}},
                      {ucid,{37,12},"X"},
                      {comma,{37,13}},
                      {lcurly,{37,15}},
                      {lcid,{37,16},"c"},
                      {colon,{37,17}},
                      {ucid,{37,18},"X"},
                      {comma,{37,19}},
                      {lcid,{37,21},"f"},
                      {colon,{37,22}},
                      {ucid,{37,23},"X"},
                      {arrow,{37,24}},
                      {nat,{37,26}},
                      {rcurly,{37,29}},
                      {rcurly,{37,30}},
                      {semi,{37,31}},
                      {'let',{38,1}},
                      {lcurly,{38,5}},
                      {ucid,{38,6},"X"},
                      {comma,{38,7}},
                      {lcid,{38,8},"ops"},
                      {rcurly,{38,11}},
                      {eq,{38,13}},
                      {lcurly,{38,15}},
                      {star,{38,16}},
                      {nat,{38,17}},
                      {comma,{38,20}},
                      {lcurly,{38,22}},
                      {lcid,{38,23},"c"},
                      {eq,{38,24}},
                      {int_value,{38,25},"0"},
                      {comma,{38,26}},
                      {lcid,{38,28},"f"},
                      {eq,{38,29}},
                      {lambda,{38,30}},
                      {lcid,{38,37},"x"},
                      {colon,{38,38}},
                      {nat,{38,39}},
                      {dot,{38,42}},
                      {succ,{38,44}},
                      {lcid,{38,49},"x"},
                      {rcurly,{38,50}},
                      {rcurly,{38,51}},
                      {as,{39,15}},
                      {lcurly,{39,18}},
                      {some,{39,19}},
                      {ucid,{39,24},"X"},
                      {comma,{39,25}},
                      {lcurly,{39,27}},
                      {lcid,{39,28},"c"},
                      {colon,{39,29}},
                      {ucid,{39,30},"X"},
                      {comma,{39,31}},
                      {lcid,{39,33},"f"},
                      {colon,{39,34}},
                      {ucid,{39,35},"X"},
                      {arrow,{39,36}},
                      {nat,{39,38}},
                      {rcurly,{39,41}},
                      {rcurly,{39,42}},
                      {in,{40,1}},
                      {lparen,{40,4}},
                      {lcid,{40,5},"ops"},
                      {dot,{40,8}},
                      {lcid,{40,9},"f"},
                      {lcid,{40,11},"ops"},
                      {dot,{40,14}},
                      {lcid,{40,15},"c"},
                      {rparen,{40,16}},
                      {semi,{40,17}}],
                  42},
                 fullpoly_lexer:string(Data)).
